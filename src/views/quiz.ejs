<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pergunta.titulo %></title>
    <link rel="stylesheet" href="/css/quiz.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="browser-bar">
                <div class="browser-dots">
                    <div class="dot orange"></div>
                    <div class="dot orange"></div>
                    <div class="dot orange"></div>
                </div>
            </div>
            <h1 class="main-title"><%= pergunta.titulo %></h1>
        </header>

        <main class="content">
            <div class="quiz-section">
                <h2 class="question"><%= pergunta.titulo %></h2>
                
                <div class="alternatives-grid">
                    <% respostas.forEach((resposta, index) => { %>
                        <div class="alternative-box" data-id="<%= resposta.id %>" onclick="selecionarResposta(this)">
                            <div class="alternative-label"><%= String.fromCharCode(65 + index) %></div>
                            <% if (resposta.imagem) { %>
                                <img src="<%= resposta.imagem %>" alt="<%= resposta.titulo %>" class="alternative-image">
                            <% } else { %>
                                <div class="alternative-text"><%= resposta.titulo %></div>
                            <% } %>
                        </div>
                    <% }); %>
                </div>
            </div>
        </main>

        <footer class="footer">
            <button class="nav-btn" id="prevBtn" onclick="voltarPagina()">
                <span>PÁGINA ANTERIOR</span>
            </button>
            
            <button class="nav-btn primary" id="nextBtn" onclick="enviarResposta()">
                <span>PRÓXIMA PÁGINA</span>
                <div class="btn-glow"></div>
            </button>
        </footer>
    </div>

    <!-- Canvas para confetes -->
    <canvas id="confetti-canvas"></canvas>

    <script>
        const ordem = <%= ordem %>;
        const total = <%= total %>;
        let respostaSelecionada = null;

        function selecionarResposta(elemento) {
            // Remove seleção anterior
            document.querySelectorAll('.alternative-box').forEach(box => {
                box.classList.remove('selected');
            });
            
            // Marca como selecionada
            elemento.classList.add('selected');
            respostaSelecionada = elemento.dataset.id;
        }

        function voltarPagina() {
            // Volta para a explicação anterior
            if (ordem > 1) {
                window.location.href = `/explicacao/<%= ordem - 1 %>/1`;
            }
        }

        function enviarResposta() {
            if (!respostaSelecionada) {
                alert('Por favor, selecione uma resposta!');
                return;
            }

            // Envia a resposta via POST
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/quiz/<%= ordem %>/submit`;

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'idResposta';
            input.value = respostaSelecionada;

            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    </script>
</body>
</html>